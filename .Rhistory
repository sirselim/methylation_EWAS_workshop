load('data/Ilmn450K_anno.RDS')
meth.anno <- readRDS('data/Ilmn450K_anno.RDS')
head(meth.anno)
load('data/blood_buccal.RData')
c(rep(0, 5), rep(1, 5))
require(minfi)
GSE40279 <- annotation[grep('GSE40279', annotation$GSE),]
GSE40279.betas <- getbeta(samples=GSE40279$Id, probes=meth.anno$IlmnID, marmalaiddir='/publicdata/marmalaid/')
buccal <- annotation[grep('Buccal', annotation$TISSUE),]
GSE40279
colnames(betas)
y <- c(rep(0, 5), rep(1, 5))
y <- as.factor(y)
levels(y) <- c('Blood', 'Buccal')
tissues <- c(rep(0, 5), rep(1, 5))
tissues <- as.factor(tissues)
levels(tissues) <- c('Blood', 'Buccal')
tissues
names(tissues)
names(tissues) <- samples
names(tissues) <- Samples
tissues
densityPlot(betas, sampGroups = tissues)
require(marmalaid)
GSE40279 <- annotation[grep('GSE40279', annotation$GSE),]
GSE40279.betas <- getbeta(samples=GSE40279$Id, probes=meth.anno$IlmnID, marmalaiddir='/publicdata/marmalaid/')
GSE40279.betas <- getbeta(samples=GSE40279$Id, probes=meth.anno$IlmnID)
d <- t(betas)
rownames(d) <- samples
samples
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on all probes", labels = pd$Sample_Name)
plot(hc, main="Cluster on all probes", labels = tissues)
?dmpFinder
results <- dmpFinder(betas, pheno = tissues, type = "categorical", qCutoff = 1)
head(results)
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta")
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta",
ylab = "methylation (beta)", xlab = 'tissue')
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta",
ylab = "methylation (beta)", col = c('red', 'blue'))
?plotCpg
betas[[cg05350268]]
betas[cg05350268,]
betas['cg05350268',]
boxplot(betas['cg05350268',] ~ tissues)
boxplot(betas['cg05350268',] ~ tissues, col = c('darkred', 'cadetblue'))
head(results)
boxplot(betas['cg19653345',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg03467405',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg07046426',] ~ tissues, col = c('darkred', 'cadetblue'))
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'))
}
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = i)
}
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
getwd()
pdf('figures/blood_v_buccal_topsites_plot.pdf')
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
dev.off()
pdf('figures/blood_v_buccal_topsites_plot.pdf', paper = 'a4')
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
dev.off()
pdf('figures/blood_v_buccal_topsites_plot.pdf', paper = 'a4r')
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
dev.off()
pdf('figures/blood_v_buccal_topsites_plot.pdf', width = 7, height = 10)
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
dev.off()
pdf('figures/blood_v_buccal_topsites_plot.pdf', width = 7, height = 10)
tissue.sites <- rownames(results)[c(1:12)]
par(mfrow = c(4,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg)
}
dev.off()
head(results)
table(results$qval < 0.05)
table(results$qval < 0.005)
table(results$qval < 0.0005)
table(results$qval < 0.00005)
top.results <- results[results$qval < 0.00005,]
tail(top.results)
head(top.results)
top.results <- results[results$qval <= 0.00005,]
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg20432671", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
top.results <- results[results$qval <= 0.05,]
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg07049424", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
top.results <- results[results$qval <= 0.005,]
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg14730445", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
top.results <- results[results$qval <= 0.0005,]
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg03720950", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
0.05/450000
top.results <- results[results$pval <= (0.05/450000),]
tail(top.results)
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg00932510", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
top.results <- results[results$qval <= 0.0005,]
top.results <- na.omit(top.results)
top.results <- results[results$qval <= 0.00005,]
top.results <- na.omit(top.results)
top.results <- results[results$qval <= 0.00005,]
top.results <- na.omit(top.results)
tail(top.results)
plotCpg(betas, cpg = "cg20432671", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
tail(results)
results <- na.omit(results)
head(results)
tail(results)
table(results$qval < 0.00005)
top.results <- results[results$qval <= 0.00005,]
tail(top.results)
tail(results)
plotCpg(betas, cpg = "cg00241218", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
top.results <- results[results$pval <= (0.05/450000),]
table(results$pval <= (0.05/450000))
top.results <- results[results$qval <= 0.00005,]
tail(top.results)
table(results$qval < 0.00005)
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
plotCpg(betas, cpg = "cg00241218", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
head(results)
tail(results)
plotCpg(betas, cpg = "cg07309136", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
plotCpg(betas, cpg = "cg07309136", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)")
boxplot(betas['cg05350268',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg19653345',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg03467405',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg07046426',] ~ tissues, col = c('darkred', 'cadetblue'))
boxplot(betas['cg05350268',] ~ tissues, col = c('darkred', 'cadetblue'), ylim = c(0,1))
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
plotCpg(betas, cpg = "cg07309136", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
boxplot(betas['cg05350268',] ~ tissues, col = c('darkred', 'cadetblue'), ylim = c(0,1))
boxplot(betas['cg19653345',] ~ tissues, col = c('darkred', 'cadetblue'), ylim = c(0,1))
boxplot(betas['cg03467405',] ~ tissues, col = c('darkred', 'cadetblue'), ylim = c(0,1))
boxplot(betas['cg07046426',] ~ tissues, col = c('darkred', 'cadetblue'), ylim = c(0,1))
# loop through a few sites
tissue.sites <- rownames(results)[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg, ylim = c(0,1))
}
tissue.sites <- rownames(tail(results, n = 12))[c(1:9)]
par(mfrow = c(3,3))
for (cpg in tissue.sites) {
boxplot(betas[cpg,] ~ tissues, col = c('darkred', 'cadetblue'), ylab = "methylation (beta)", xlab = "tissue", main = cpg, ylim = c(0,1))
}
sig.betas <- betas[rownames(betas) %in% rownames(top.results),]
d <- t(sig.betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on selected top tissue discrimination CpG sites", labels = tissues)
d <- t(sig.betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on selected top tissue discrimination CpG sites", labels = tissues)
head(GSE48472)
head(GSE40279)
head(samples)
samples
?hc
head(annotation)
head(meth.anno)
meth.anno <- readRDS('data/Ilmn450K_anno.RDS')
head(meth.anno)
anno.sub <- meth.anno[meth.anno$IlmnID %in% rownames(top.results),]
table(anno.sub$CHR)
table(anno.sub$UCSC_RefGene_Name) #
unique(anno.sub$UCSC_RefGene_Name) #
unique(unlist(strsplit(anno.sub$UCSC_RefGene_Name, split = ';'))) #
length(unique(unlist(strsplit(anno.sub$UCSC_RefGene_Name, split = ';')))) #
genes <- length(unique(unlist(strsplit(anno.sub$UCSC_RefGene_Name, split = ';'))))
write.table(genes, 'EWAS_blood_buccal_genelist.txt', row.names = F, col.names = F)
genes <- unique(unlist(strsplit(anno.sub$UCSC_RefGene_Name, split = ';')))
write.table(genes, 'EWAS_blood_buccal_genelist.txt', row.names = F, col.names = F)
write.table(genes, 'EWAS_blood_buccal_genelist.txt', row.names = F, col.names = F, quote = F)
setwd("~/gitrepos/methylation_EWAS_workshop")
require(minfi)
#####################################################
### 2. load data
#####################################################
meth.anno <- readRDS('data/Ilmn450K_anno.RDS')
load('data/blood_buccal.RData')
#####################################################
### 3. set up samples/data and basic QC explore
#####################################################
# define samples
tissues <- c(rep(0, 5), rep(1, 5))
tissues <- as.factor(tissues)
levels(tissues) <- c('Blood', 'Buccal')
names(tissues) <- Samples
# create a densoty plot
densityPlot(betas, sampGroups = tissues)
# Hierarchical Clustering
d <- t(betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on all probes", labels = tissues)
load("/media/disk1part1/PostDoc/Rod/blood_buccal/data/all_buccal_blood.RData")
head(buccal)
table(buccal$GSE)
densityPlot(buccal.betas)
densityPlot(blood.betas)
densityPlot(GSE40279.betas)
nrows(GSE40279.betas[,1])
nrows(GSE40279.betas[1,])
nrow(GSE40279.betas[1,])
nrow(GSE40279.betas[1])
nrow(GSE40279.betas[,1])
?nrow
nrow(GSE40279.betas)
nrow(GSE40279.betas[1])
nrow(GSE40279.betas[,1])
nrow(GSE40279.betas[[1]])
head(GSE40279.betas)
head(GSE40279.betas[1])
head(GSE40279.betas[1,])
head(GSE40279.betas[,1])
ncol(GSE40279.betas)
densityPlot(GSE40279.betas[,1])
densityPlot(as.matrix(GSE40279.betas[,1]))
names(GSE40279.betas[,1])
colnames(GSE40279.betas)
colnames(GSE40279.betas)[1]
densityPlot(as.matrix(GSE40279.betas[,1]), main = colnames(GSE40279.betas)[1])
pdf('testing.pdf', width = 7, height = 10)
par(mfrow = c(3,3))
for (i in ncol(GSE40279.betas)){
densityPlot(as.matrix(GSE40279.betas[,i]), main = colnames(GSE40279.betas)[i])
}
dev.off()
pdf('testing.pdf', width = 7, height = 10)
par(mfrow = c(3,3))
for (i in c(1:ncol(GSE40279.betas))){
densityPlot(as.matrix(GSE40279.betas[,i]), main = colnames(GSE40279.betas)[i])
}
dev.off()
pdf('testing2.pdf', width = 7, height = 10)
par(mfrow = c(3,3))
for (i in c(1:ncol(buccal.betas))){
densityPlot(as.matrix(buccal.betas[,i]), main = colnames(buccal.betas)[i])
}
dev.off()
c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')
head(buccal.betas[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037'),])
head(buccal.betas[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')])
head(buccal.betas[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')])
buccal.betas2 <- as.data.frame(buccal.betas)
head(buccal.betas2[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')]))
head(buccal.betas2[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')])
buccal.betas2 <- buccal.betas2[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')]
densityPlot(buccal.betas2)
densityPlot(as.matrix(buccal.betas2))
str(buccal.betas2)
setwd("/media/disk1part1/methylation_data/longitudinal_NI")
## generate 'bad' probes filter
cross.react <- read.csv('../48639-non-specific-probes-Illumina450k.csv', head = T)
cross.react.probes <- as.character(cross.react$TargetID)
multi.map <- read.csv('../HumanMethylation450_15017482_v.1.1_hg19.mult.txt', head = F)
multi.map.probes <- as.character(multi.map$V1)
#length(unique(c(cross.react.probes, multi.map.probes)))
filter.probes <- unique(c(cross.react.probes, multi.map.probes))
setwd("~/gitrepos/methylation_EWAS_workshop")
table(rownames(betas) %in% filter.probes)
betas <- betas[rownames(betas) %in% filter.probes,]
densityPlot(betas, sampGroups = tissues)
str(betas)
load('data/blood_buccal.RData')
table(rownames(betas) %in% filter.probes)
betas <- betas[!(rownames(betas) %in% filter.probes),]
densityPlot(betas, sampGroups = tissues)
Samples
buccal.betas2 <- as.data.frame(buccal.betas)
buccal.betas2 <- buccal.betas2[c("GSM1179533", "GSM1179534", "GSM1179535", "GSM1179536", "GSM1179537")]
buccal.betas2 <- as.data.frame(buccal.betas)
buccal.betas2 <- buccal.betas2[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')]
densityPlot(as.matrix(buccal.betas2))
table(colnames(buccal.betas2) %in% c("GSM1179533", "GSM1179534", "GSM1179535", "GSM1179536", "GSM1179537"))
buccal.betas2 <- as.data.frame(buccal.betas)
table(colnames(buccal.betas2) %in% c("GSM1179533", "GSM1179534", "GSM1179535", "GSM1179536", "GSM1179537"))
GSE40279.betas2 <- as.data.frame(GSE40279.betas)
blood.betas <- GSE40279.betas2[c("GSM1179533", "GSM1179534", "GSM1179535", "GSM1179536", "GSM1179537")]
table(colnames(GSE40279.betas2) %in% c("GSM1179533", "GSM1179534", "GSM1179535", "GSM1179536", "GSM1179537"))
betas2 <- as.data.frame(betas)
betas2 <- betas2[c(1:5)]
densityPlot(as.matrix(betas2))
d <- t(betas2)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on all probes", labels = colnames(betas2))
betas2 <- betas2[-1]
densityPlot(as.matrix(betas2))
d <- t(betas2)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on all probes", labels = colnames(betas2))
grep('GSM990423', colnames(GSE40279.betas2))
GSM990423 <- data.frame(IlmnID = rownames(GSE40279.betas2), GSM990423 = GSE40279.betas2[grep('GSM990423', colnames(GSE40279.betas2)),])
head(GSE40279.betas2[grep('GSM990423', colnames(GSE40279.betas2)),])
GSM990423 <- data.frame(IlmnID = rownames(GSE40279.betas2), GSM990423 = GSE40279.betas2[,grep('GSM990423', colnames(GSE40279.betas2))])
head(GSM990423)
densityPlot(betas, sampGroups = tissues)
# Hierarchical Clustering
d <- t(betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on all probes", labels = tissues)
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
# Hierarchical Clustering
d <- t(sig.betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on selected top tissue discrimination CpG sites", labels = tissues)
# subset the beta matrix by the top markers and cluster
sig.betas <- betas[rownames(betas) %in% rownames(top.results),]
# Hierarchical Clustering
d <- t(sig.betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on selected top tissue discrimination CpG sites", labels = tissues)
# minfi dmpfinder
results <- dmpFinder(betas, pheno = tissues, type = "categorical", qCutoff = 1)
results <- na.omit(results)
head(results)
tail(results)
# explore some results
table(results$qval < 0.00005)
top.results <- results[results$qval <= 0.00005,]
tail(top.results)
# bonferroni correction
table(results$pval <= (0.05/450000))
# top.results <- results[results$pval <= (0.05/450000),]
sig.betas <- betas[rownames(betas) %in% rownames(top.results),]
# Hierarchical Clustering
d <- t(sig.betas)
rownames(d) <- tissues
d <- dist(d, method = "minkowski", p = 2)
hc <- hclust(d)
plot(hc, main="Cluster on selected top tissue discrimination CpG sites", labels = tissues)
plotCpg(betas, cpg = "cg07309136", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
plotCpg(betas, cpg = "cg05350268", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
plotCpg(betas, cpg = "cg07309136", pheno = tissues, type = "categorical", measure = "beta", ylab = "methylation (beta)", ylim = c(0,1))
betas.blood <- data.frame(IlmnID = rownames(betas2), betas2)
new.beta <- merge(betas.blood, GSM990423, by = 'IlmnID')
head(new.beta)
head(betas.blood)
head(GSM990423)
table(betas.blood$IlmnID %in% GSM990423$IlmnID)
new.beta <- merge(betas.blood, GSM990423, by = 'IlmnID', sort = F)
head(new.beta)
densityPlot(as.matrix(new.beta))
tail(new.beta)
rownames(new.beta) <- new.beta$IlmnID
new.beta <- new.beta[-1]
new.beta <- na.omit(new.beta)
new.beta <- as.matrix(new.beta)
densityPlot(as.matrix(new.beta))
densityPlot(as.matrix(buccal.betas2))
buccal.betas2 <- as.data.frame(buccal.betas)
buccal.betas2 <- buccal.betas2[c('GSM1179540', 'GSM1179542', 'GSM1224032', 'GSM1224035', 'GSM1224037')]
densityPlot(as.matrix(buccal.betas2))
buccal.betas2 <- data.frame(IlmnID = rownames(buccal.betas2), buccal.betas2)
head(buccal.betas2)
new.beta <- data.frame(IlmnID = rownames(new.beta), new.beta)
head(new.beta)
final.beta <- merge(new.beta, buccal.betas2, by = 'IlmnID', sort = F)
head(final.beta)
rownames(final.beta) <- final.beta$IlmnID
final.beta <- final.beta[-1]
final.beta <- as.matrix(final.beta)
densityPlot(final.beta)
densityPlot(final.beta, sampGroups = c(rep('blood', 5), rep('buccal', 5)))
final.beta <- final.beta[rownames(final.beta) %in% filter.probes,]
final.beta <- merge(new.beta, buccal.betas2, by = 'IlmnID', sort = F)
rownames(final.beta) <- final.beta$IlmnID
final.beta <- final.beta[-1]
final.beta <- final.beta[rownames(final.beta) %in% filter.probes,]
final.beta <- merge(new.beta, buccal.betas2, by = 'IlmnID', sort = F)
rownames(final.beta) <- final.beta$IlmnID
final.beta <- final.beta[-1]
head(final.beta)
table(rownames(final.beta) %in% filter.probes)
final.beta <- final.beta[!(rownames(final.beta) %in% filter.probes),]
final.beta <- as.matrix(final.beta)
densityPlot(final.beta, sampGroups = c(rep('blood', 5), rep('buccal', 5)))
saveRDS(final.beta, 'data/blood_buccal.RDS')
